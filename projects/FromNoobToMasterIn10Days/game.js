var Module=typeof Module!=="undefined"?Module:{};var moduleOverrides={};var key;for(key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var arguments_=[];var thisProgram="./this.program";var quit_=function(status,toThrow){throw toThrow};var ENVIRONMENT_IS_WEB=false;var ENVIRONMENT_IS_WORKER=false;var ENVIRONMENT_IS_NODE=false;var ENVIRONMENT_IS_SHELL=false;ENVIRONMENT_IS_WEB=typeof window==="object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function";ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var read_,readAsync,readBinary,setWindowTitle;var nodeFS;var nodePath;if(ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){scriptDirectory=require("path").dirname(scriptDirectory)+"/"}else{scriptDirectory=__dirname+"/"}read_=function shell_read(filename,binary){if(!nodeFS)nodeFS=require("fs");if(!nodePath)nodePath=require("path");filename=nodePath["normalize"](filename);return nodeFS["readFileSync"](filename,binary?null:"utf8")};readBinary=function readBinary(filename){var ret=read_(filename,true);if(!ret.buffer){ret=new Uint8Array(ret)}assert(ret.buffer);return ret};if(process["argv"].length>1){thisProgram=process["argv"][1].replace(/\\/g,"/")}arguments_=process["argv"].slice(2);if(typeof module!=="undefined"){module["exports"]=Module}process["on"]("uncaughtException",function(ex){if(!(ex instanceof ExitStatus)){throw ex}});process["on"]("unhandledRejection",abort);quit_=function(status){process["exit"](status)};Module["inspect"]=function(){return"[Emscripten Module object]"}}else if(ENVIRONMENT_IS_SHELL){if(typeof read!="undefined"){read_=function shell_read(f){return read(f)}}readBinary=function readBinary(f){var data;if(typeof readbuffer==="function"){return new Uint8Array(readbuffer(f))}data=read(f,"binary");assert(typeof data==="object");return data};if(typeof scriptArgs!="undefined"){arguments_=scriptArgs}else if(typeof arguments!="undefined"){arguments_=arguments}if(typeof quit==="function"){quit_=function(status){quit(status)}}if(typeof print!=="undefined"){if(typeof console==="undefined")console={};console.log=print;console.warn=console.error=typeof printErr!=="undefined"?printErr:print}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!=="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.indexOf("blob:")!==0){scriptDirectory=scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1)}else{scriptDirectory=""}{read_=function shell_read(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER){readBinary=function readBinary(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=function readAsync(url,onload,onerror){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function xhr_onload(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);return}onerror()};xhr.onerror=onerror;xhr.send(null)}}setWindowTitle=function(title){document.title=title}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.warn.bind(console);for(key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];if(Module["quit"])quit_=Module["quit"];var STACK_ALIGN=16;function warnOnce(text){if(!warnOnce.shown)warnOnce.shown={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;err(text)}}function convertJsFunctionToWasm(func,sig){if(typeof WebAssembly.Function==="function"){var typeNames={"i":"i32","j":"i64","f":"f32","d":"f64"};var type={parameters:[],results:sig[0]=="v"?[]:[typeNames[sig[0]]]};for(var i=1;i<sig.length;++i){type.parameters.push(typeNames[sig[i]])}return new WebAssembly.Function(type,func)}var typeSection=[1,0,1,96];var sigRet=sig.slice(0,1);var sigParam=sig.slice(1);var typeCodes={"i":127,"j":126,"f":125,"d":124};typeSection.push(sigParam.length);for(var i=0;i<sigParam.length;++i){typeSection.push(typeCodes[sigParam[i]])}if(sigRet=="v"){typeSection.push(0)}else{typeSection=typeSection.concat([1,typeCodes[sigRet]])}typeSection[1]=typeSection.length-2;var bytes=new Uint8Array([0,97,115,109,1,0,0,0].concat(typeSection,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0]));var module=new WebAssembly.Module(bytes);var instance=new WebAssembly.Instance(module,{"e":{"f":func}});var wrappedFunc=instance.exports["f"];return wrappedFunc}var freeTableIndexes=[];var functionsInTableMap;function getEmptyTableSlot(){if(freeTableIndexes.length){return freeTableIndexes.pop()}try{wasmTable.grow(1)}catch(err){if(!(err instanceof RangeError)){throw err}throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return wasmTable.length-1}function addFunctionWasm(func,sig){if(!functionsInTableMap){functionsInTableMap=new WeakMap;for(var i=0;i<wasmTable.length;i++){var item=wasmTable.get(i);if(item){functionsInTableMap.set(item,i)}}}if(functionsInTableMap.has(func)){return functionsInTableMap.get(func)}var ret=getEmptyTableSlot();try{wasmTable.set(ret,func)}catch(err){if(!(err instanceof TypeError)){throw err}var wrapped=convertJsFunctionToWasm(func,sig);wasmTable.set(ret,wrapped)}functionsInTableMap.set(func,ret);return ret}var tempRet0=0;var wasmBinary;if(Module["wasmBinary"])wasmBinary=Module["wasmBinary"];var noExitRuntime;if(Module["noExitRuntime"])noExitRuntime=Module["noExitRuntime"];if(typeof WebAssembly!=="object"){abort("no native wasm support detected")}function setValue(ptr,value,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":HEAP8[ptr>>0]=value;break;case"i8":HEAP8[ptr>>0]=value;break;case"i16":HEAP16[ptr>>1]=value;break;case"i32":HEAP32[ptr>>2]=value;break;case"i64":tempI64=[value>>>0,(tempDouble=value,+Math.abs(tempDouble)>=1?tempDouble>0?(Math.min(+Math.floor(tempDouble/4294967296),4294967295)|0)>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[ptr>>2]=tempI64[0],HEAP32[ptr+4>>2]=tempI64[1];break;case"float":HEAPF32[ptr>>2]=value;break;case"double":HEAPF64[ptr>>3]=value;break;default:abort("invalid type for setValue: "+type)}}function getValue(ptr,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":return HEAP8[ptr>>0];case"i8":return HEAP8[ptr>>0];case"i16":return HEAP16[ptr>>1];case"i32":return HEAP32[ptr>>2];case"i64":return HEAP32[ptr>>2];case"float":return HEAPF32[ptr>>2];case"double":return HEAPF64[ptr>>3];default:abort("invalid type for getValue: "+type)}return null}var wasmMemory;var ABORT=false;var EXITSTATUS;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}function getCFunc(ident){var func=Module["_"+ident];assert(func,"Cannot call unknown function "+ident+", make sure it is exported");return func}function ccall(ident,returnType,argTypes,args,opts){var toC={"string":function(str){var ret=0;if(str!==null&&str!==undefined&&str!==0){var len=(str.length<<2)+1;ret=stackAlloc(len);stringToUTF8(str,ret,len)}return ret},"array":function(arr){var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string")return UTF8ToString(ret);if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func.apply(null,cArgs);ret=convertReturnValue(ret);if(stack!==0)stackRestore(stack);return ret}var ALLOC_STACK=1;var UTF8Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):undefined;function UTF8ArrayToString(heap,idx,maxBytesToRead){var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heap[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heap.subarray&&UTF8Decoder){return UTF8Decoder.decode(heap.subarray(idx,endPtr))}else{var str="";while(idx<endPtr){var u0=heap[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heap[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heap[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heap[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}}return str}function UTF8ToString(ptr,maxBytesToRead){return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""}function stringToUTF8Array(str,heap,outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++]=192|u>>6;heap[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++]=224|u>>12;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++]=240|u>>18;heap[outIdx++]=128|u>>12&63;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}}heap[outIdx]=0;return outIdx-startIdx}function stringToUTF8(str,outPtr,maxBytesToWrite){return stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite)}function lengthBytesUTF8(str){var len=0;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127)++len;else if(u<=2047)len+=2;else if(u<=65535)len+=3;else len+=4}return len}function AsciiToString(ptr){var str="";while(1){var ch=HEAPU8[ptr++>>0];if(!ch)return str;str+=String.fromCharCode(ch)}}var UTF16Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf-16le"):undefined;function writeArrayToMemory(array,buffer){HEAP8.set(array,buffer)}function writeAsciiToMemory(str,buffer,dontAddNull){for(var i=0;i<str.length;++i){HEAP8[buffer++>>0]=str.charCodeAt(i)}if(!dontAddNull)HEAP8[buffer>>0]=0}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateGlobalBufferAndViews(buf){buffer=buf;Module["HEAP8"]=HEAP8=new Int8Array(buf);Module["HEAP16"]=HEAP16=new Int16Array(buf);Module["HEAP32"]=HEAP32=new Int32Array(buf);Module["HEAPU8"]=HEAPU8=new Uint8Array(buf);Module["HEAPU16"]=HEAPU16=new Uint16Array(buf);Module["HEAPU32"]=HEAPU32=new Uint32Array(buf);Module["HEAPF32"]=HEAPF32=new Float32Array(buf);Module["HEAPF64"]=HEAPF64=new Float64Array(buf)}var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||16777216;var wasmTable;var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;var runtimeExited=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};function abort(what){if(Module["onAbort"]){Module["onAbort"](what)}what+="";err(what);ABORT=true;EXITSTATUS=1;what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(what);throw e}function hasPrefix(str,prefix){return String.prototype.startsWith?str.startsWith(prefix):str.indexOf(prefix)===0}var dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return hasPrefix(filename,dataURIPrefix)}var fileURIPrefix="file://";function isFileURI(filename){return hasPrefix(filename,fileURIPrefix)}var wasmBinaryFile="game.wasm";if(!isDataURI(wasmBinaryFile)){wasmBinaryFile=locateFile(wasmBinaryFile)}function getBinary(file){try{if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}else{throw"both async and sync fetching of the wasm failed"}}catch(err){abort(err)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&typeof fetch==="function"&&!isFileURI(wasmBinaryFile)){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"]){throw"failed to load wasm binary file at '"+wasmBinaryFile+"'"}return response["arrayBuffer"]()}).catch(function(){return getBinary(wasmBinaryFile)})}return Promise.resolve().then(function(){return getBinary(wasmBinaryFile)})}function createWasm(){var info={"env":asmLibraryArg,"wasi_snapshot_preview1":asmLibraryArg};function receiveInstance(instance,module){var exports=instance.exports;Module["asm"]=exports;wasmMemory=Module["asm"]["memory"];updateGlobalBufferAndViews(wasmMemory.buffer);wasmTable=Module["asm"]["__indirect_function_table"];removeRunDependency("wasm-instantiate")}addRunDependency("wasm-instantiate");function receiveInstantiatedSource(output){receiveInstance(output["instance"])}function instantiateArrayBuffer(receiver){return getBinaryPromise().then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason);abort(reason)})}function instantiateAsync(){if(!wasmBinary&&typeof WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&!isFileURI(wasmBinaryFile)&&typeof fetch==="function"){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){var result=WebAssembly.instantiateStreaming(response,info);return result.then(receiveInstantiatedSource,function(reason){err("wasm streaming compile failed: "+reason);err("falling back to ArrayBuffer instantiation");return instantiateArrayBuffer(receiveInstantiatedSource)})})}else{return instantiateArrayBuffer(receiveInstantiatedSource)}}if(Module["instantiateWasm"]){try{var exports=Module["instantiateWasm"](info,receiveInstance);return exports}catch(e){err("Module.instantiateWasm callback failed with error: "+e);return false}}instantiateAsync();return{}}var tempDouble;var tempI64;function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback(Module);continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){wasmTable.get(func)()}else{wasmTable.get(func)(callback.arg)}}else{func(callback.arg===undefined?null:callback.arg)}}}function demangle(func){return func}function demangleAll(text){var regex=/\b_Z[\w\d_]+/g;return text.replace(regex,function(x){var y=demangle(x);return x===y?x:y+" ["+x+"]"})}function jsStackTrace(){var error=new Error;if(!error.stack){try{throw new Error}catch(e){error=e}if(!error.stack){return"(no stack trace available)"}}return error.stack.toString()}function _atexit(func,arg){}function ___cxa_atexit(a0,a1){return _atexit(a0,a1)}function _drawImage(url,screen_x,screen_y,width,height){if(!gameGeneral.ctx){gameGeneral.ctx=Module["ctx"]}let ctx=gameGeneral.ctx;if(gameGeneral.cached_urls[url]){let cached_image=gameGeneral.cached_urls[url];if(!cached_image.is_loaded)return;let image=cached_image.image;let screen_width=width;let screen_height=height;ctx.fillStyle=0;ctx.drawImage(image,0,0,image.height,image.height,screen_x,screen_y,screen_width,screen_height)}else{let image=new Image;image.onload=function(){gameGeneral.cached_urls[url].is_loaded=true};image.src=AsciiToString(url);gameGeneral.cached_urls[url]={image:image,is_loaded:false}}}function _drawSprite(sprite,screen_x,screen_y,scale_x,scale_y){if(!gameGeneral.ctx){gameGeneral.ctx=Module["ctx"]}let ctx=gameGeneral.ctx;let id=getValue(sprite+4*0,"i32");let x=getValue(sprite+4*1,"i32");let y=getValue(sprite+4*2,"i32");let width=getValue(sprite+4*3,"i32");let height=getValue(sprite+4*4,"i32");let screen_width=width*scale_x;let screen_height=height*scale_y;let internal=gameGeneral.images[id];ctx.fillStyle=0;ctx.drawImage(internal.image,x,y,width,height,screen_x,screen_y,screen_width,screen_height)}var _emscripten_get_now;if(ENVIRONMENT_IS_NODE){_emscripten_get_now=function(){var t=process["hrtime"]();return t[0]*1e3+t[1]/1e6}}else if(typeof dateNow!=="undefined"){_emscripten_get_now=dateNow}else _emscripten_get_now=function(){return performance.now()};function _emscripten_memcpy_big(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)}function _emscripten_random(){return Math.random()}function abortOnCannotGrowMemory(requestedSize){abort("OOM")}function _emscripten_resize_heap(requestedSize){requestedSize=requestedSize>>>0;abortOnCannotGrowMemory(requestedSize)}var Browser={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null;Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var timingMode=Browser.mainLoop.timingMode;var timingValue=Browser.mainLoop.timingValue;var func=Browser.mainLoop.func;Browser.mainLoop.func=null;setMainLoop(func,0,false,Browser.mainLoop.arg,true);_emscripten_set_main_loop_timing(timingMode,timingValue);Browser.mainLoop.scheduler()},updateStatus:function(){if(Module["setStatus"]){var message=Module["statusMessage"]||"Please wait...";var remaining=Browser.mainLoop.remainingBlockers;var expected=Browser.mainLoop.expectedBlockers;if(remaining){if(remaining<expected){Module["setStatus"](message+" ("+(expected-remaining)+"/"+expected+")")}else{Module["setStatus"](message)}}else{Module["setStatus"]("")}}},runIter:function(func){if(ABORT)return;if(Module["preMainLoop"]){var preRet=Module["preMainLoop"]();if(preRet===false){return}}try{func()}catch(e){if(e instanceof ExitStatus){return}else if(e=="unwind"){return}else{if(e&&typeof e==="object"&&e.stack)err("exception thrown: "+[e,e.stack]);throw e}}if(Module["postMainLoop"])Module["postMainLoop"]()}},isFullscreen:false,pointerLock:false,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(!Module["preloadPlugins"])Module["preloadPlugins"]=[];if(Browser.initted)return;Browser.initted=true;try{new Blob;Browser.hasBlobConstructor=true}catch(e){Browser.hasBlobConstructor=false;console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder=typeof MozBlobBuilder!="undefined"?MozBlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:!Browser.hasBlobConstructor?console.log("warning: no BlobBuilder"):null;Browser.URLObject=typeof window!="undefined"?window.URL?window.URL:window.webkitURL:undefined;if(!Module.noImageDecoding&&typeof Browser.URLObject==="undefined"){console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available.");Module.noImageDecoding=true}var imagePlugin={};imagePlugin["canHandle"]=function imagePlugin_canHandle(name){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(name)};imagePlugin["handle"]=function imagePlugin_handle(byteArray,name,onload,onerror){var b=null;if(Browser.hasBlobConstructor){try{b=new Blob([byteArray],{type:Browser.getMimetype(name)});if(b.size!==byteArray.length){b=new Blob([new Uint8Array(byteArray).buffer],{type:Browser.getMimetype(name)})}}catch(e){warnOnce("Blob constructor present but fails: "+e+"; falling back to blob builder")}}if(!b){var bb=new Browser.BlobBuilder;bb.append(new Uint8Array(byteArray).buffer);b=bb.getBlob()}var url=Browser.URLObject.createObjectURL(b);var img=new Image;img.onload=function img_onload(){assert(img.complete,"Image "+name+" could not be decoded");var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);Module["preloadedImages"][name]=canvas;Browser.URLObject.revokeObjectURL(url);if(onload)onload(byteArray)};img.onerror=function img_onerror(event){console.log("Image "+url+" could not be decoded");if(onerror)onerror()};img.src=url};Module["preloadPlugins"].push(imagePlugin);var audioPlugin={};audioPlugin["canHandle"]=function audioPlugin_canHandle(name){return!Module.noAudioDecoding&&name.substr(-4)in{".ogg":1,".wav":1,".mp3":1}};audioPlugin["handle"]=function audioPlugin_handle(byteArray,name,onload,onerror){var done=false;function finish(audio){if(done)return;done=true;Module["preloadedAudios"][name]=audio;if(onload)onload(byteArray)}function fail(){if(done)return;done=true;Module["preloadedAudios"][name]=new Audio;if(onerror)onerror()}if(Browser.hasBlobConstructor){try{var b=new Blob([byteArray],{type:Browser.getMimetype(name)})}catch(e){return fail()}var url=Browser.URLObject.createObjectURL(b);var audio=new Audio;audio.addEventListener("canplaythrough",function(){finish(audio)},false);audio.onerror=function audio_onerror(event){if(done)return;console.log("warning: browser could not fully decode audio "+name+", trying slower base64 approach");function encode64(data){var BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var PAD="=";var ret="";var leftchar=0;var leftbits=0;for(var i=0;i<data.length;i++){leftchar=leftchar<<8|data[i];leftbits+=8;while(leftbits>=6){var curr=leftchar>>leftbits-6&63;leftbits-=6;ret+=BASE[curr]}}if(leftbits==2){ret+=BASE[(leftchar&3)<<4];ret+=PAD+PAD}else if(leftbits==4){ret+=BASE[(leftchar&15)<<2];ret+=PAD}return ret}audio.src="data:audio/x-"+name.substr(-3)+";base64,"+encode64(byteArray);finish(audio)};audio.src=url;Browser.safeSetTimeout(function(){finish(audio)},1e4)}else{return fail()}};Module["preloadPlugins"].push(audioPlugin);function pointerLockChange(){Browser.pointerLock=document["pointerLockElement"]===Module["canvas"]||document["mozPointerLockElement"]===Module["canvas"]||document["webkitPointerLockElement"]===Module["canvas"]||document["msPointerLockElement"]===Module["canvas"]}var canvas=Module["canvas"];if(canvas){canvas.requestPointerLock=canvas["requestPointerLock"]||canvas["mozRequestPointerLock"]||canvas["webkitRequestPointerLock"]||canvas["msRequestPointerLock"]||function(){};canvas.exitPointerLock=document["exitPointerLock"]||document["mozExitPointerLock"]||document["webkitExitPointerLock"]||document["msExitPointerLock"]||function(){};canvas.exitPointerLock=canvas.exitPointerLock.bind(document);document.addEventListener("pointerlockchange",pointerLockChange,false);document.addEventListener("mozpointerlockchange",pointerLockChange,false);document.addEventListener("webkitpointerlockchange",pointerLockChange,false);document.addEventListener("mspointerlockchange",pointerLockChange,false);if(Module["elementPointerLock"]){canvas.addEventListener("click",function(ev){if(!Browser.pointerLock&&Module["canvas"].requestPointerLock){Module["canvas"].requestPointerLock();ev.preventDefault()}},false)}}},createContext:function(canvas,useWebGL,setInModule,webGLContextAttributes){if(useWebGL&&Module.ctx&&canvas==Module.canvas)return Module.ctx;var ctx;var contextHandle;if(useWebGL){var contextAttributes={antialias:false,alpha:false,majorVersion:1};if(webGLContextAttributes){for(var attribute in webGLContextAttributes){contextAttributes[attribute]=webGLContextAttributes[attribute]}}if(typeof GL!=="undefined"){contextHandle=GL.createContext(canvas,contextAttributes);if(contextHandle){ctx=GL.getContext(contextHandle).GLctx}}}else{ctx=canvas.getContext("2d")}if(!ctx)return null;if(setInModule){if(!useWebGL)assert(typeof GLctx==="undefined","cannot set in module if GLctx is used, but we are a non-GL context that would replace it");Module.ctx=ctx;if(useWebGL)GL.makeContextCurrent(contextHandle);Module.useWebGL=useWebGL;Browser.moduleContextCreatedCallbacks.forEach(function(callback){callback()});Browser.init()}return ctx},destroyContext:function(canvas,useWebGL,setInModule){},fullscreenHandlersInstalled:false,lockPointer:undefined,resizeCanvas:undefined,requestFullscreen:function(lockPointer,resizeCanvas){Browser.lockPointer=lockPointer;Browser.resizeCanvas=resizeCanvas;if(typeof Browser.lockPointer==="undefined")Browser.lockPointer=true;if(typeof Browser.resizeCanvas==="undefined")Browser.resizeCanvas=false;var canvas=Module["canvas"];function fullscreenChange(){Browser.isFullscreen=false;var canvasContainer=canvas.parentNode;if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvasContainer){canvas.exitFullscreen=Browser.exitFullscreen;if(Browser.lockPointer)canvas.requestPointerLock();Browser.isFullscreen=true;if(Browser.resizeCanvas){Browser.setFullscreenCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}else{canvasContainer.parentNode.insertBefore(canvas,canvasContainer);canvasContainer.parentNode.removeChild(canvasContainer);if(Browser.resizeCanvas){Browser.setWindowedCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}if(Module["onFullScreen"])Module["onFullScreen"](Browser.isFullscreen);if(Module["onFullscreen"])Module["onFullscreen"](Browser.isFullscreen)}if(!Browser.fullscreenHandlersInstalled){Browser.fullscreenHandlersInstalled=true;document.addEventListener("fullscreenchange",fullscreenChange,false);document.addEventListener("mozfullscreenchange",fullscreenChange,false);document.addEventListener("webkitfullscreenchange",fullscreenChange,false);document.addEventListener("MSFullscreenChange",fullscreenChange,false)}var canvasContainer=document.createElement("div");canvas.parentNode.insertBefore(canvasContainer,canvas);canvasContainer.appendChild(canvas);canvasContainer.requestFullscreen=canvasContainer["requestFullscreen"]||canvasContainer["mozRequestFullScreen"]||canvasContainer["msRequestFullscreen"]||(canvasContainer["webkitRequestFullscreen"]?function(){canvasContainer["webkitRequestFullscreen"](Element["ALLOW_KEYBOARD_INPUT"])}:null)||(canvasContainer["webkitRequestFullScreen"]?function(){canvasContainer["webkitRequestFullScreen"](Element["ALLOW_KEYBOARD_INPUT"])}:null);canvasContainer.requestFullscreen()},exitFullscreen:function(){if(!Browser.isFullscreen){return false}var CFS=document["exitFullscreen"]||document["cancelFullScreen"]||document["mozCancelFullScreen"]||document["msExitFullscreen"]||document["webkitCancelFullScreen"]||function(){};CFS.apply(document,[]);return true},nextRAF:0,fakeRequestAnimationFrame:function(func){var now=Date.now();if(Browser.nextRAF===0){Browser.nextRAF=now+1e3/60}else{while(now+2>=Browser.nextRAF){Browser.nextRAF+=1e3/60}}var delay=Math.max(Browser.nextRAF-now,0);setTimeout(func,delay)},requestAnimationFrame:function(func){if(typeof requestAnimationFrame==="function"){requestAnimationFrame(func);return}var RAF=Browser.fakeRequestAnimationFrame;RAF(func)},safeCallback:function(func){return function(){if(!ABORT)return func.apply(null,arguments)}},allowAsyncCallbacks:true,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){Browser.allowAsyncCallbacks=false},resumeAsyncCallbacks:function(){Browser.allowAsyncCallbacks=true;if(Browser.queuedAsyncCallbacks.length>0){var callbacks=Browser.queuedAsyncCallbacks;Browser.queuedAsyncCallbacks=[];callbacks.forEach(function(func){func()})}},safeRequestAnimationFrame:function(func){return Browser.requestAnimationFrame(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}else{Browser.queuedAsyncCallbacks.push(func)}})},safeSetTimeout:function(func,timeout){noExitRuntime=true;return setTimeout(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}else{Browser.queuedAsyncCallbacks.push(func)}},timeout)},safeSetInterval:function(func,timeout){noExitRuntime=true;return setInterval(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}},timeout)},getMimetype:function(name){return{"jpg":"image/jpeg","jpeg":"image/jpeg","png":"image/png","bmp":"image/bmp","ogg":"audio/ogg","wav":"audio/wav","mp3":"audio/mpeg"}[name.substr(name.lastIndexOf(".")+1)]},getUserMedia:function(func){if(!window.getUserMedia){window.getUserMedia=navigator["getUserMedia"]||navigator["mozGetUserMedia"]}window.getUserMedia(func)},getMovementX:function(event){return event["movementX"]||event["mozMovementX"]||event["webkitMovementX"]||0},getMovementY:function(event){return event["movementY"]||event["mozMovementY"]||event["webkitMovementY"]||0},getMouseWheelDelta:function(event){var delta=0;switch(event.type){case"DOMMouseScroll":delta=event.detail/3;break;case"mousewheel":delta=event.wheelDelta/120;break;case"wheel":delta=event.deltaY;switch(event.deltaMode){case 0:delta/=100;break;case 1:delta/=3;break;case 2:delta*=80;break;default:throw"unrecognized mouse wheel delta mode: "+event.deltaMode}break;default:throw"unrecognized mouse wheel event: "+event.type}return delta},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(event){if(Browser.pointerLock){if(event.type!="mousemove"&&"mozMovementX"in event){Browser.mouseMovementX=Browser.mouseMovementY=0}else{Browser.mouseMovementX=Browser.getMovementX(event);Browser.mouseMovementY=Browser.getMovementY(event)}if(typeof SDL!="undefined"){Browser.mouseX=SDL.mouseX+Browser.mouseMovementX;Browser.mouseY=SDL.mouseY+Browser.mouseMovementY}else{Browser.mouseX+=Browser.mouseMovementX;Browser.mouseY+=Browser.mouseMovementY}}else{var rect=Module["canvas"].getBoundingClientRect();var cw=Module["canvas"].width;var ch=Module["canvas"].height;var scrollX=typeof window.scrollX!=="undefined"?window.scrollX:window.pageXOffset;var scrollY=typeof window.scrollY!=="undefined"?window.scrollY:window.pageYOffset;if(event.type==="touchstart"||event.type==="touchend"||event.type==="touchmove"){var touch=event.touch;if(touch===undefined){return}var adjustedX=touch.pageX-(scrollX+rect.left);var adjustedY=touch.pageY-(scrollY+rect.top);adjustedX=adjustedX*(cw/rect.width);adjustedY=adjustedY*(ch/rect.height);var coords={x:adjustedX,y:adjustedY};if(event.type==="touchstart"){Browser.lastTouches[touch.identifier]=coords;Browser.touches[touch.identifier]=coords}else if(event.type==="touchend"||event.type==="touchmove"){var last=Browser.touches[touch.identifier];if(!last)last=coords;Browser.lastTouches[touch.identifier]=last;Browser.touches[touch.identifier]=coords}return}var x=event.pageX-(scrollX+rect.left);var y=event.pageY-(scrollY+rect.top);x=x*(cw/rect.width);y=y*(ch/rect.height);Browser.mouseMovementX=x-Browser.mouseX;Browser.mouseMovementY=y-Browser.mouseY;Browser.mouseX=x;Browser.mouseY=y}},asyncLoad:function(url,onload,onerror,noRunDep){var dep=!noRunDep?getUniqueRunDependency("al "+url):"";readAsync(url,function(arrayBuffer){assert(arrayBuffer,'Loading data file "'+url+'" failed (no arrayBuffer).');onload(new Uint8Array(arrayBuffer));if(dep)removeRunDependency(dep)},function(event){if(onerror){onerror()}else{throw'Loading data file "'+url+'" failed.'}});if(dep)addRunDependency(dep)},resizeListeners:[],updateResizeListeners:function(){var canvas=Module["canvas"];Browser.resizeListeners.forEach(function(listener){listener(canvas.width,canvas.height)})},setCanvasSize:function(width,height,noUpdates){var canvas=Module["canvas"];Browser.updateCanvasDimensions(canvas,width,height);if(!noUpdates)Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags|8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags&~8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},updateCanvasDimensions:function(canvas,wNative,hNative){if(wNative&&hNative){canvas.widthNative=wNative;canvas.heightNative=hNative}else{wNative=canvas.widthNative;hNative=canvas.heightNative}var w=wNative;var h=hNative;if(Module["forcedAspectRatio"]&&Module["forcedAspectRatio"]>0){if(w/h<Module["forcedAspectRatio"]){w=Math.round(h*Module["forcedAspectRatio"])}else{h=Math.round(w/Module["forcedAspectRatio"])}}if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvas.parentNode&&typeof screen!="undefined"){var factor=Math.min(screen.width/w,screen.height/h);w=Math.round(w*factor);h=Math.round(h*factor)}if(Browser.resizeCanvas){if(canvas.width!=w)canvas.width=w;if(canvas.height!=h)canvas.height=h;if(typeof canvas.style!="undefined"){canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}else{if(canvas.width!=wNative)canvas.width=wNative;if(canvas.height!=hNative)canvas.height=hNative;if(typeof canvas.style!="undefined"){if(w!=wNative||h!=hNative){canvas.style.setProperty("width",w+"px","important");canvas.style.setProperty("height",h+"px","important")}else{canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}}},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var handle=Browser.nextWgetRequestHandle;Browser.nextWgetRequestHandle++;return handle}};function _emscripten_set_main_loop_timing(mode,value){Browser.mainLoop.timingMode=mode;Browser.mainLoop.timingValue=value;if(!Browser.mainLoop.func){return 1}if(mode==0){Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_setTimeout(){var timeUntilNextTick=Math.max(0,Browser.mainLoop.tickStartTime+value-_emscripten_get_now())|0;setTimeout(Browser.mainLoop.runner,timeUntilNextTick)};Browser.mainLoop.method="timeout"}else if(mode==1){Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_rAF(){Browser.requestAnimationFrame(Browser.mainLoop.runner)};Browser.mainLoop.method="rAF"}else if(mode==2){if(typeof setImmediate==="undefined"){var setImmediates=[];var emscriptenMainLoopMessageId="setimmediate";var Browser_setImmediate_messageHandler=function(event){if(event.data===emscriptenMainLoopMessageId||event.data.target===emscriptenMainLoopMessageId){event.stopPropagation();setImmediates.shift()()}};addEventListener("message",Browser_setImmediate_messageHandler,true);setImmediate=function Browser_emulated_setImmediate(func){setImmediates.push(func);if(ENVIRONMENT_IS_WORKER){if(Module["setImmediates"]===undefined)Module["setImmediates"]=[];Module["setImmediates"].push(func);postMessage({target:emscriptenMainLoopMessageId})}else postMessage(emscriptenMainLoopMessageId,"*")}}Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_setImmediate(){setImmediate(Browser.mainLoop.runner)};Browser.mainLoop.method="immediate"}return 0}function setMainLoop(browserIterationFunc,fps,simulateInfiniteLoop,arg,noSetTiming){noExitRuntime=true;assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters.");Browser.mainLoop.func=browserIterationFunc;Browser.mainLoop.arg=arg;var thisMainLoopId=Browser.mainLoop.currentlyRunningMainloop;Browser.mainLoop.runner=function Browser_mainLoop_runner(){if(ABORT)return;if(Browser.mainLoop.queue.length>0){var start=Date.now();var blocker=Browser.mainLoop.queue.shift();blocker.func(blocker.arg);if(Browser.mainLoop.remainingBlockers){var remaining=Browser.mainLoop.remainingBlockers;var next=remaining%1==0?remaining-1:Math.floor(remaining);if(blocker.counted){Browser.mainLoop.remainingBlockers=next}else{next=next+.5;Browser.mainLoop.remainingBlockers=(8*remaining+next)/9}}console.log('main loop blocker "'+blocker.name+'" took '+(Date.now()-start)+" ms");Browser.mainLoop.updateStatus();if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;setTimeout(Browser.mainLoop.runner,0);return}if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0;if(Browser.mainLoop.timingMode==1&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0){Browser.mainLoop.scheduler();return}else if(Browser.mainLoop.timingMode==0){Browser.mainLoop.tickStartTime=_emscripten_get_now()}Browser.mainLoop.runIter(browserIterationFunc);if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;if(typeof SDL==="object"&&SDL.audio&&SDL.audio.queueNewAudioData)SDL.audio.queueNewAudioData();Browser.mainLoop.scheduler()};if(!noSetTiming){if(fps&&fps>0)_emscripten_set_main_loop_timing(0,1e3/fps);else _emscripten_set_main_loop_timing(1,1);Browser.mainLoop.scheduler()}if(simulateInfiniteLoop){throw"unwind"}}function _emscripten_set_main_loop(func,fps,simulateInfiniteLoop,arg,noSetTiming){var browserIterationFunc=wasmTable.get(func);setMainLoop(browserIterationFunc,fps,simulateInfiniteLoop,arg,noSetTiming)}var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(stream,curr){var buffer=SYSCALLS.buffers[stream];if(curr===0||curr===10){(stream===1?out:err)(UTF8ArrayToString(buffer,0));buffer.length=0}else{buffer.push(curr)}},varargs:undefined,get:function(){SYSCALLS.varargs+=4;var ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(ptr){var ret=UTF8ToString(ptr);return ret},get64:function(low,high){return low}};function _fd_write(fd,iov,iovcnt,pnum){var num=0;for(var i=0;i<iovcnt;i++){var ptr=HEAP32[iov+i*8>>2];var len=HEAP32[iov+(i*8+4)>>2];for(var j=0;j<len;j++){SYSCALLS.printChar(fd,HEAPU8[ptr+j])}num+=len}HEAP32[pnum>>2]=num;return 0}function _fill(r,g,b,a){let red=gameGeneral.numToColor(r);let green=gameGeneral.numToColor(g);let blue=gameGeneral.numToColor(b);let alpha=gameGeneral.numToColor(a);let str=`#${red}${green}${blue}${alpha}`;gameGeneral.current_fill_color=str}function _loadFont(cstr_family,cstr_url){let family=AsciiToString(cstr_family);let url=AsciiToString(cstr_url);let font=new FontFace(family,`url(${url})`);font.loaded.then(function(f){document.fonts.add(f)},err=>{console.error(err)});gameGeneral.fonts.push(font);font.load()}function _loadSpriteSheet(ascii_url){let url=AsciiToString(ascii_url);let is_loaded=0;let width=0;let height=0;let id=gameGeneral.images.length;let result=_malloc(16);setValue(result+4*0,is_loaded,"i32");setValue(result+4*1,id,"i32");setValue(result+4*2,width,"i32");setValue(result+4*3,height,"i32");let image=new Image;image.onload=function(){setValue(result+4*0,true,"i32");setValue(result+4*2,image.width,"i32");setValue(result+4*3,image.height,"i32")};image.src=url;let internal_image={image:image,pointer:result};gameGeneral.images.push(internal_image);return result}var gameGeneral={ctx:null,images:[],cached_urls:[],current_fill_color:"#00000000",current_stroke_color:"#00000000",current_font:"",current_font_size:"10px",fonts:[],clamp:function(n,min,max){if(n>max)return max;else if(n<min)return min;return n},numToColor:function(num){num=gameGeneral.clamp(num,0,255);let str=num.toString(16);if(str.length<2)str="0"+str;return str}};var pWindow={windows:[],keys:[],mouse_buttons:[],active:null,current_fptr:null,pWindowFlags:{PSTD_NO_WINDOW_FLAGS:0,PSTD_FULL_SCREEN:0},pState:{PSTD_PRESSED:1,PSTD_HELD:2,PSTD_RELEASED:0},pKey:{PSTD_SPACE:32,PSTD_KEY_0:48,PSTD_KEY_1:49,PSTD_KEY_2:50,PSTD_KEY_3:51,PSTD_KEY_4:52,PSTD_KEY_5:53,PSTD_KEY_6:54,PSTD_KEY_7:55,PSTD_KEY_8:56,PSTD_KEY_9:57,PSTD_KEY_A:97,PSTD_KEY_B:98,PSTD_KEY_C:99,PSTD_KEY_D:100,PSTD_KEY_E:101,PSTD_KEY_F:102,PSTD_KEY_G:103,PSTD_KEY_H:104,PSTD_KEY_I:105,PSTD_KEY_J:106,PSTD_KEY_K:107,PSTD_KEY_L:108,PSTD_KEY_M:109,PSTD_KEY_N:110,PSTD_KEY_O:111,PSTD_KEY_P:112,PSTD_KEY_Q:113,PSTD_KEY_R:114,PSTD_KEY_S:115,PSTD_KEY_T:116,PSTD_KEY_U:117,PSTD_KEY_V:118,PSTD_KEY_W:119,PSTD_KEY_X:120,PSTD_KEY_Y:121,PSTD_KEY_Z:122,PSTD_ENTER:256,PSTD_TAB:258,PSTD_DELETE:259,PSTD_END:260,PSTD_HOME:261,PSTD_INSERT:262,PSTD_PAGE_DOWN:263,PSTD_PAGE_UP:264,PSTD_ARROW_DOWN:265,PSTD_ARROW_LEFT:266,PSTD_ARROW_RIGHT:267,PSTD_ARROW_UP:268,PSTD_ESCAPE:269,PSTD_CAPSLOCK:270,PSTD_LEFT_ALT:273,PSTD_RIGHT_ALT:274,PSTD_ALT:275,PSTD_LEFT_CONTROL:289,PSTD_RIGHT_CONTROL:290,PSTD_CONTROL:291,PSTD_LEFT_SUPER:321,PSTD_RIGHT_SUPER:322,PSTD_SUPER:323,PSTD_LEFT_SHIFT:385,PSTD_RIGHT_SHIFT:386,PSTD_SHIFT:387},pMods:{PSTD_MOD_SHIFT:1,PSTD_MOD_CONTROL:2,PSTD_MOD_ALT:4,PSTD_MOD_SUPER:8},pDomKeyCodeToKey:function(key_code,is_left){switch(key_code){case 49:return pWindow.pKey.PSTD_KEY_1;case 50:return pWindow.pKey.PSTD_KEY_2;case 51:return pWindow.pKey.PSTD_KEY_3;case 52:return pWindow.pKey.PSTD_KEY_4;case 53:return pWindow.pKey.PSTD_KEY_5;case 54:return pWindow.pKey.PSTD_KEY_6;case 55:return pWindow.pKey.PSTD_KEY_7;case 56:return pWindow.pKey.PSTD_KEY_8;case 57:return pWindow.pKey.PSTD_KEY_9;case 48:return pWindow.pKey.PSTD_KEY_0;case 65:return pWindow.pKey.PSTD_KEY_A;case 66:return pWindow.pKey.PSTD_KEY_B;case 67:return pWindow.pKey.PSTD_KEY_C;case 68:return pWindow.pKey.PSTD_KEY_D;case 69:return pWindow.pKey.PSTD_KEY_E;case 70:return pWindow.pKey.PSTD_KEY_F;case 71:return pWindow.pKey.PSTD_KEY_G;case 72:return pWindow.pKey.PSTD_KEY_H;case 73:return pWindow.pKey.PSTD_KEY_I;case 74:return pWindow.pKey.PSTD_KEY_J;case 75:return pWindow.pKey.PSTD_KEY_K;case 76:return pWindow.pKey.PSTD_KEY_L;case 77:return pWindow.pKey.PSTD_KEY_M;case 78:return pWindow.pKey.PSTD_KEY_N;case 79:return pWindow.pKey.PSTD_KEY_O;case 80:return pWindow.pKey.PSTD_KEY_P;case 81:return pWindow.pKey.PSTD_KEY_Q;case 82:return pWindow.pKey.PSTD_KEY_R;case 83:return pWindow.pKey.PSTD_KEY_S;case 84:return pWindow.pKey.PSTD_KEY_T;case 85:return pWindow.pKey.PSTD_KEY_U;case 86:return pWindow.pKey.PSTD_KEY_V;case 87:return pWindow.pKey.PSTD_KEY_W;case 88:return pWindow.pKey.PSTD_KEY_X;case 89:return pWindow.pKey.PSTD_KEY_Y;case 90:return pWindow.pKey.PSTD_KEY_Z;case 18:return is_left?pWindow.pKey.PSTD_LEFT_ALT:pWindow.pKey.PSTD_RIGHT_ALT;case 17:return is_left?pWindow.pKey.PSTD_LEFT_CONTROL:pWindow.pKey.PSTD_RIGHT_CONTROL;case 16:return is_left?pWindow.pKey.PSTD_LEFT_SHIFT:pWindow.pKey.PSTD_RIGHT_SHIFT;case 91:return pWindow.pKey.PSTD_LEFT_SUPER;case 92:return pWindow.pKey.PSTD_RIGHT_SUPER;case 20:return pWindow.pKey.PSTD_CAPSLOCK;case 13:return pWindow.pKey.PSTD_ENTER;case 32:return pWindow.pKey.PSTD_SPACE;case 9:return pWindow.pKey.PSTD_TAB;case 46:return pWindow.pKey.PSTD_DELETE;case 35:return pWindow.pKey.PSTD_END;case 36:return pWindow.pKey.PSTD_HOME;case 45:return pWindow.pKey.PSTD_INSERT;case 34:return pWindow.pKey.PSTD_PAGE_DOWN;case 33:return pWindow.pKey.PSTD_PAGE_UP;case 40:return pWindow.pKey.PSTD_ARROW_DOWN;case 37:return pWindow.pKey.PSTD_ARROW_LEFT;case 39:return pWindow.pKey.PSTD_ARROW_RIGHT;case 38:return pWindow.pKey.PSTD_ARROW_UP;case 27:return pWindow.pKey.PSTD_ESCAPE;default:return key_code+is_left}},pKeyToIndex:function(key){switch(key){case pWindow.pKey.PSTD_SPACE:return 0;case pWindow.pKey.PSTD_KEY_0:return 1;case pWindow.pKey.PSTD_KEY_1:return 2;case pWindow.pKey.PSTD_KEY_2:return 3;case pWindow.pKey.PSTD_KEY_3:return 4;case pWindow.pKey.PSTD_KEY_4:return 5;case pWindow.pKey.PSTD_KEY_5:return 6;case pWindow.pKey.PSTD_KEY_6:return 7;case pWindow.pKey.PSTD_KEY_7:return 8;case pWindow.pKey.PSTD_KEY_8:return 9;case pWindow.pKey.PSTD_KEY_9:return 10;case pWindow.pKey.PSTD_KEY_A:return 11;case pWindow.pKey.PSTD_KEY_B:return 12;case pWindow.pKey.PSTD_KEY_C:return 13;case pWindow.pKey.PSTD_KEY_D:return 14;case pWindow.pKey.PSTD_KEY_E:return 15;case pWindow.pKey.PSTD_KEY_F:return 16;case pWindow.pKey.PSTD_KEY_G:return 17;case pWindow.pKey.PSTD_KEY_H:return 18;case pWindow.pKey.PSTD_KEY_I:return 19;case pWindow.pKey.PSTD_KEY_J:return 21;case pWindow.pKey.PSTD_KEY_K:return 22;case pWindow.pKey.PSTD_KEY_L:return 23;case pWindow.pKey.PSTD_KEY_M:return 24;case pWindow.pKey.PSTD_KEY_N:return 25;case pWindow.pKey.PSTD_KEY_O:return 26;case pWindow.pKey.PSTD_KEY_P:return 27;case pWindow.pKey.PSTD_KEY_Q:return 28;case pWindow.pKey.PSTD_KEY_R:return 29;case pWindow.pKey.PSTD_KEY_S:return 30;case pWindow.pKey.PSTD_KEY_T:return 31;case pWindow.pKey.PSTD_KEY_U:return 32;case pWindow.pKey.PSTD_KEY_V:return 33;case pWindow.pKey.PSTD_KEY_W:return 34;case pWindow.pKey.PSTD_KEY_X:return 35;case pWindow.pKey.PSTD_KEY_Y:return 36;case pWindow.pKey.PSTD_KEY_Z:return 37;case pWindow.pKey.PSTD_ENTER:return 38;case pWindow.pKey.PSTD_TAB:return 39;case pWindow.pKey.PSTD_DELETE:return 40;case pWindow.pKey.PSTD_END:return 41;case pWindow.pKey.PSTD_HOME:return 42;case pWindow.pKey.PSTD_INSERT:return 43;case pWindow.pKey.PSTD_PAGE_DOWN:return 44;case pWindow.pKey.PSTD_PAGE_UP:return 45;case pWindow.pKey.PSTD_ARROW_DOWN:return 46;case pWindow.pKey.PSTD_ARROW_LEFT:return 47;case pWindow.pKey.PSTD_ARROW_RIGHT:return 48;case pWindow.pKey.PSTD_ARROW_UP:return 49;case pWindow.pKey.PSTD_ESCAPE:return 50;case pWindow.pKey.PSTD_CAPSLOCK:return 51;case pWindow.pKey.PSTD_LEFT_ALT:return 52;case pWindow.pKey.PSTD_RIGHT_ALT:return 53;case pWindow.pKey.PSTD_LEFT_CONTROL:return 54;case pWindow.pKey.PSTD_RIGHT_CONTROL:return 55;case pWindow.pKey.PSTD_LEFT_SUPER:return 56;case pWindow.pKey.PSTD_RIGHT_SUPER:return 57;case pWindow.pKey.PSTD_LEFT_SHIFT:return 58;case pWindow.pKey.PSTD_RIGHT_SHIFT:return 59;default:return key}},pWindowInfo:function(info){this.x=getValue(info+4*0,"i32");this.y=getValue(info+4*1,"i32");this.width=getValue(info+4*2,"i32");this.height=getValue(info+4*3,"i32");let c_str=getValue(info+4*4,"i8*");if(c_str===0)this.title="";else this.title=AsciiToString(c_str);if(this.x<=0)this.x="default";if(this.y<=0)this.y="default";if(this.width<=0)this.width=960;if(this.height<=0)this.height=540;return this},pWindow:function(context,canvas,x,y,width,height,title){canvas.width=width;canvas.height=height;document.title=title;this.id=0;this.x=x;this.y=y;this.width=width;this.height=height;this.title=title;this.event_handler={key_event_handler:[],mouse_button_handler:[],mouse_scroll_handler:[],mouse_position_handler:[]};this.context=context;this.canvas=canvas;return this},isKeyDown:function(key){let pKey=pWindow.pKey;let keys=pWindow.keys;let getIndex=pWindow.pKeyToIndex;if(!keys)return 0;if(key==pKey.PSTD_SHIFT){if(keys[getIndex(pKey.PSTD_LEFT_SHIFT)])return keys[getIndex(pKey.PSTD_LEFT_SHIFT)];else{return keys[getIndex(pKey.PSTD_RIGHT_SHIFT)]??0}}else if(key==pKey.PSTD_CONTROL){if(keys[getIndex(pKey.PSTD_LEFT_CONTROL)])return keys[getIndex(pKey.PSTD_LEFT_CONTROL)];else{return keys[getIndex(pKey.PSTD_RIGHT_CONTROL)]??0}}else if(key==pKey.PSTD_ALT){if(keys[getIndex(pKey.PSTD_LEFT_ALT)])return keys[getIndex(pKey.PSTD_LEFT_ALT)];else{return keys[getIndex(pKey.PSTD_RIGHT_ALT)]??0}}else if(key==pKey.PSTD_SUPER){if(keys[getIndex(pKey.PSTD_LEFT_SUPER)])return keys[getIndex(pKey.PSTD_LEFT_SUPER)];else{return keys[getIndex(pKey.PSTD_RIGHT_SUPER)]??0}}return keys[getIndex(key)]??0},getMods:function(){let keyDown=pWindow.isKeyDown;let pKey=pWindow.pKey;let pMods=pWindow.pMods;let mods=0;if(keyDown(pKey.PSTD_SHIFT))mods=pMods.PSTD_MOD_SHIFT;if(keyDown(pKey.PSTD_CONTROL))mods=mods|pMods.PSTD_MOD_CONTROL;if(keyDown(pKey.PSTD_ALT))mods=mods|pMods.PSTD_MOD_ALT;if(keyDown(pKey.PSTD_SUPER))mods=mods|pMods.PSTD_MOD_SUPER;return mods},getWindow:function(id){if(id==0)abort("invalid window");return this.windows[id-1]},onKeyChanged:function(event,new_state){let is_left=event.location==KeyboardEvent.DOM_KEY_LOCATION_LEFT;let key=pWindow.pDomKeyCodeToKey(event.keyCode,is_left);let index=pWindow.pKeyToIndex(key);if(new_state&&this.keys[index])this.keys[index]=pWindow.pState.PSTD_HELD;else this.keys[index]=new_state;let mods=pWindow.getMods();if(!this.active)return;let window=pWindow.getWindow(this.active);let handlers=window.event_handler.key_event_handler;for(let i=handlers.length-1;i>-1;i--){let handler=handlers[i];current_fptr=handler;let callback=wasmTable.get(handler);let result=callback(this.active,this.keys[index],key,mods);if(result)break}},onKeyDown:function(event){pWindow.onKeyChanged(event,pWindow.pState.PSTD_PRESSED)},onKeyUp:function(event){pWindow.onKeyChanged(event,pWindow.pState.PSTD_RELEASED)},onMouseChanged:function(event,new_state){if(event.target!=Module["canvas"])return;let button=event.button;if(button==1){button=2}else if(button==2){button=1}if(new_state&&this.mouse_buttons[button])this.mouse_buttons[button]=pWindow.pState.PSTD_HELD;else this.mouse_buttons[button]=new_state;let mods=pWindow.getMods();if(!this.active)return;let window=pWindow.getWindow(this.active);let handlers=window.event_handler.mouse_button_handler;for(let i=handlers.length-1;i>-1;i--){let handler=handlers[i];current_fptr=handler;let callback=wasmTable.get(handler);let result=callback(this.active,this.mouse_buttons[button],button,mods);if(result)break}},onMouseDown:function(event){pWindow.onMouseChanged(event,pWindow.pState.PSTD_PRESSED)},onMouseUp:function(event){pWindow.onMouseChanged(event,pWindow.pState.PSTD_RELEASED)},onMouseMove:function(event){if(!pWindow.active)return;Browser.calculateMouseEvent(event);let window=pWindow.getWindow(pWindow.active);let handlers=window.event_handler.mouse_position_handler;for(let i=handlers.length-1;i>-1;i--){let handler=handlers[i];current_fptr=handler;let callback=wasmTable.get(handler);let result=callback(this.active,Browser.mouseX,Browser.mouseY);if(result)break}}};function _pCreateWindow(info){let window_info=new pWindow.pWindowInfo(info);let ctx=Browser.createContext(Module["canvas"],false,true);if(!ctx)return 0;let new_canvas=document.createElement("canvas");new_canvas.width=window_info.width;new_canvas.height=window_info.height;new_canvas.id="canvas";let p_window=new pWindow.pWindow(ctx,Module["canvas"],window_info.x,window_info.y,window_info.width,window_info.height,window_info.title);pWindow.windows.push(p_window);let id=pWindow.windows.length;p_window.id=id;let ui=document.getElementById("controls");ui.style.display="none";let cmd=document.getElementById("output");cmd.style.display="none";let style=Module["canvas"].style;style.display="block";if(p_window.x=="default"){style.marginLeft="auto";style.marginRight="auto"}else{style.position="relative";style.left=p_window.x+"px"}if(p_window.y=="default"){style.marginTop="auto";style.marginBottom="auto"}else{style.position="relative";style.top=p_window.y+"px"}window.addEventListener("keydown",pWindow.onKeyDown);window.addEventListener("keyup",pWindow.onKeyUp);Module["canvas"].addEventListener("mousedown",pWindow.onMouseDown);Module["canvas"].addEventListener("mouseup",pWindow.onMouseUp);Module["canvas"].addEventListener("mousemove",pWindow.onMouseMove);return id}function _pPushKeyboardEventHandler(window_id,event_handler){let window=pWindow.getWindow(window_id);window.event_handler["key_event_handler"].push(event_handler)}function _pPushMouseButtonEventHandler(window_id,event_handler){let window=pWindow.getWindow(window_id);window.event_handler["mouse_button_handler"].push(event_handler)}function _pPushMousePositionEventHandler(window_id,event_handler){let window=pWindow.getWindow(window_id);window.event_handler["mouse_position_handler"].push(event_handler)}function _pSetActiveWindow(window){let old=pWindow.active;pWindow.active=window;return old??0}function _rect(x,y,width,height){if(!gameGeneral.ctx){gameGeneral.ctx=Module["ctx"]}let ctx=gameGeneral.ctx;ctx.fillStyle=gameGeneral.current_fill_color;ctx.fillRect(x,y,width,height)}function _setFont(px,cstr_font){let font=AsciiToString(cstr_font);gameGeneral.current_font=font;gameGeneral.current_font_size=`${px}px`}function _text(cstr_text,x,y){if(!gameGeneral.ctx){gameGeneral.ctx=Module["ctx"]}let ctx=gameGeneral.ctx;let text=AsciiToString(cstr_text);if(gameGeneral.font!=""){ctx.font=`${gameGeneral.current_font_size} ${gameGeneral.current_font}`}ctx.fillStyle=gameGeneral.current_fill_color;ctx.strokeStyle=gameGeneral.current_stroke_color;ctx.fillText(text,x,y)}function _textAlign(align,baseline){if(!gameGeneral.ctx){gameGeneral.ctx=Module["ctx"]}let ctx=gameGeneral.ctx;switch(baseline){case 0:ctx.textbaseline="top";case 1:ctx.textbaseline="middle";case 2:ctx.textbaseline="bottom";case 3:ctx.textbaseline="alphabetic"}switch(align){case 0:ctx.textAlign="left";case 1:ctx.textAlign="right";case 2:ctx.textAlign="center"}}Module["requestFullscreen"]=function Module_requestFullscreen(lockPointer,resizeCanvas){Browser.requestFullscreen(lockPointer,resizeCanvas)};Module["requestAnimationFrame"]=function Module_requestAnimationFrame(func){Browser.requestAnimationFrame(func)};Module["setCanvasSize"]=function Module_setCanvasSize(width,height,noUpdates){Browser.setCanvasSize(width,height,noUpdates)};Module["pauseMainLoop"]=function Module_pauseMainLoop(){Browser.mainLoop.pause()};Module["resumeMainLoop"]=function Module_resumeMainLoop(){Browser.mainLoop.resume()};Module["getUserMedia"]=function Module_getUserMedia(){Browser.getUserMedia()};Module["createContext"]=function Module_createContext(canvas,useWebGL,setInModule,webGLContextAttributes){return Browser.createContext(canvas,useWebGL,setInModule,webGLContextAttributes)};var ASSERTIONS=false;__ATINIT__.push({func:function(){___wasm_call_ctors()}});var asmLibraryArg={"__cxa_atexit":___cxa_atexit,"drawImage":_drawImage,"drawSprite":_drawSprite,"emscripten_get_now":_emscripten_get_now,"emscripten_memcpy_big":_emscripten_memcpy_big,"emscripten_random":_emscripten_random,"emscripten_resize_heap":_emscripten_resize_heap,"emscripten_set_main_loop":_emscripten_set_main_loop,"fd_write":_fd_write,"fill":_fill,"loadFont":_loadFont,"loadSpriteSheet":_loadSpriteSheet,"pCreateWindow":_pCreateWindow,"pPushKeyboardEventHandler":_pPushKeyboardEventHandler,"pPushMouseButtonEventHandler":_pPushMouseButtonEventHandler,"pPushMousePositionEventHandler":_pPushMousePositionEventHandler,"pSetActiveWindow":_pSetActiveWindow,"rect":_rect,"setFont":_setFont,"text":_text,"textAlign":_textAlign};var asm=createWasm();var ___wasm_call_ctors=Module["___wasm_call_ctors"]=function(){return(___wasm_call_ctors=Module["___wasm_call_ctors"]=Module["asm"]["__wasm_call_ctors"]).apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return(_malloc=Module["_malloc"]=Module["asm"]["malloc"]).apply(null,arguments)};var _free=Module["_free"]=function(){return(_free=Module["_free"]=Module["asm"]["free"]).apply(null,arguments)};var _main=Module["_main"]=function(){return(_main=Module["_main"]=Module["asm"]["main"]).apply(null,arguments)};var ___errno_location=Module["___errno_location"]=function(){return(___errno_location=Module["___errno_location"]=Module["asm"]["__errno_location"]).apply(null,arguments)};var stackSave=Module["stackSave"]=function(){return(stackSave=Module["stackSave"]=Module["asm"]["stackSave"]).apply(null,arguments)};var stackRestore=Module["stackRestore"]=function(){return(stackRestore=Module["stackRestore"]=Module["asm"]["stackRestore"]).apply(null,arguments)};var stackAlloc=Module["stackAlloc"]=function(){return(stackAlloc=Module["stackAlloc"]=Module["asm"]["stackAlloc"]).apply(null,arguments)};var calledRun;function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}var calledMain=false;dependenciesFulfilled=function runCaller(){if(!calledRun)run();if(!calledRun)dependenciesFulfilled=runCaller};function callMain(args){var entryFunction=Module["_main"];var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exit(ret,true)}catch(e){if(e instanceof ExitStatus){return}else if(e=="unwind"){noExitRuntime=true;return}else{var toLog=e;if(e&&typeof e==="object"&&e.stack){toLog=[e,e.stack]}err("exception thrown: "+toLog);quit_(1,e)}}finally{calledMain=true}}function run(args){args=args||arguments_;if(runDependencies>0){return}preRun();if(runDependencies>0)return;function doRun(){if(calledRun)return;calledRun=true;Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();if(shouldRunNow)callMain(args);postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else{doRun()}}Module["run"]=run;function exit(status,implicit){if(implicit&&noExitRuntime&&status===0){return}if(noExitRuntime){}else{EXITSTATUS=status;exitRuntime();if(Module["onExit"])Module["onExit"](status);ABORT=true}quit_(status,new ExitStatus(status))}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}var shouldRunNow=true;if(Module["noInitialRun"])shouldRunNow=false;noExitRuntime=true;run();
